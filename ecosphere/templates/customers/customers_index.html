{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <h1 class="mb-4">Customers</h1>
  <h2>Total Potential: {{ total_potential }}</h2>
</div>
  <div class="container mt-5">
    <label>
      Show all customers
      <input type="checkbox" id="show-all-switch">
  </label>
    <table class="table table-striped" id="customers-table">
      <thead>
        <tr>
          <th>GPID</th>
          <th>Name</th>
          <th>Date of Creation</th>
          <th>Potential</th>
          <!-- Remove the Actions column -->
        </tr>
      </thead>
      <tbody>
        {% for customer in customers %}
         <tr data-id="{{ customer.id }}">
          <td class="bid">{{ customer.bid }}</td>
     <td class="name">{{ customer.name }}</td>

<td class="date_of_creation">{{ customer.date_of_creation }}</td>
<td class="Potential">{{ customer.Potential }}</td>
<!-- Remove the buttons from the table -->
          </tr>
        {% empty %}
        {% endfor %}
          <tr>
            <td colspan="4">No customers available.</td>
          </tr>
      </tbody>
    </table>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('show-all-switch').addEventListener('change', function() {
    fetch('/customers_index?show_all=' + this.checked)
      .then(response => response.json())
      .then(data => {
        var table = document.getElementById('customers-table');
        // Clear the table
        while (table.rows.length > 1) {
          table.deleteRow(1);
        }
        // Add new rows
        data.customers.forEach(function(customer) {
          var row = table.insertRow(-1);
          row.setAttribute('data-id', customer.id);
          ['bid', 'name', 'date_of_creation', 'Potential'].forEach(function(field) {
            var cell = row.insertCell(-1);
            cell.textContent = customer[field];
            cell.className = field;
          });
        });
        // Update total potential
        document.querySelector('.container h2').textContent = 'Total Potential: ' + data.total_potential;
      });
  });
});
</script>

{% endblock %}